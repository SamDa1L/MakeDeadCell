# Dead Cells Test Framework - æ¶æ„æ–‡æ¡£

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### ç³»ç»Ÿå±‚æ¬¡ç»“æ„

```
æ¸¸æˆæ¶æ„å±‚çº§:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GameManager                            â”‚ â† é¡¶å±‚ç®¡ç†å™¨
â”‚                   (æ ¸å¿ƒåè°ƒè€…)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ ¸å¿ƒç³»ç»Ÿ       â”‚   æˆ¿é—´ç³»ç»Ÿ       â”‚     æ•°æ®ç³»ç»Ÿ           â”‚
â”‚                â”‚                â”‚                       â”‚
â”‚ PlayerControllerâ”‚  RoomManager    â”‚  CastleDBManager      â”‚
â”‚ CombatManager   â”‚  LDtkRoomManagerâ”‚  WeaponFactory        â”‚ 
â”‚ EffectsManager  â”‚  Room           â”‚  LDtkManager          â”‚
â”‚                â”‚  RoomDoor       â”‚  DataDrivenWeapon     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç©å®¶ç³»ç»Ÿ       â”‚   æˆ˜æ–—ç³»ç»Ÿ       â”‚     æ­¦å™¨ç³»ç»Ÿ           â”‚
â”‚                â”‚                â”‚                       â”‚
â”‚ PlayerInput     â”‚  Health         â”‚  Weapon (åŸºç±»)        â”‚
â”‚ PlayerStates    â”‚  DamageInfo     â”‚  MeleeWeapon          â”‚
â”‚ StateMachine    â”‚  HitstunControl â”‚  RangedWeapon         â”‚
â”‚ AnimController  â”‚  EnemyControllerâ”‚  Projectile           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‚ å‘½åç©ºé—´æ¶æ„

### å‘½åç©ºé—´è®¾è®¡åŸåˆ™
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼Œé¿å…å¾ªç¯ä¾èµ–
- æ¯ä¸ªå‘½åç©ºé—´èŒè´£å•ä¸€æ¸…æ™°
- æ”¯æŒæ°´å¹³æ‰©å±•å’Œå‚ç›´æ·±åŒ–

```csharp
DeadCellsTestFramework
â”œâ”€â”€ Core                    // æ ¸å¿ƒç®¡ç†ï¼Œå…¶ä»–ç³»ç»Ÿçš„åè°ƒè€…
â”‚   â””â”€â”€ GameManager         // å•ä¾‹ç®¡ç†å™¨ï¼Œç³»ç»Ÿæ€»å…¥å£
â”œâ”€â”€ Player                  // ç©å®¶ç›¸å…³ï¼Œè¾“å…¥å¤„ç†å’ŒçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ PlayerController    // ç©å®¶ä¸»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ PlayerInput         // è¾“å…¥å°è£…
â”‚   â”œâ”€â”€ PlayerStateMachine  // çŠ¶æ€æœºç®¡ç†å™¨
â”‚   â””â”€â”€ PlayerStates        // å…·ä½“çŠ¶æ€å®ç°
â”œâ”€â”€ Combat                  // æˆ˜æ–—ç³»ç»Ÿï¼Œä¼¤å®³è®¡ç®—å’Œç”Ÿå‘½ç®¡ç†
â”‚   â”œâ”€â”€ CombatManager       // æˆ˜æ–—ä¸­å¤®å¤„ç†å™¨
â”‚   â”œâ”€â”€ Health              // ç”Ÿå‘½å€¼ç³»ç»Ÿ
â”‚   â”œâ”€â”€ DamageInfo          // ä¼¤å®³ä¿¡æ¯å°è£…
â”‚   â”œâ”€â”€ HitstunController   // ç¡¬ç›´çŠ¶æ€æ§åˆ¶
â”‚   â””â”€â”€ EnemyController     // æ•ŒäººAIæ§åˆ¶
â”œâ”€â”€ Weapons                 // æ­¦å™¨ç³»ç»Ÿï¼Œæ”»å‡»è¡Œä¸ºå’Œä¼¤å®³è¾“å‡º
â”‚   â”œâ”€â”€ Weapon              // æ­¦å™¨æŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ MeleeWeapon         // è¿‘æˆ˜æ­¦å™¨å®ç°
â”‚   â”œâ”€â”€ RangedWeapon        // è¿œç¨‹æ­¦å™¨å®ç°
â”‚   â””â”€â”€ Projectile          // æŠ•å°„ç‰©æ§åˆ¶
â”œâ”€â”€ Rooms                   // æˆ¿é—´å’Œå…³å¡ç³»ç»Ÿ
â”‚   â”œâ”€â”€ RoomManager         // ä¼ ç»Ÿæˆ¿é—´ç®¡ç†
â”‚   â”œâ”€â”€ Room                // æˆ¿é—´æ•°æ®å’Œé€»è¾‘
â”‚   â”œâ”€â”€ RoomDoor            // æˆ¿é—´è¿æ¥é—¨
â”‚   â””â”€â”€ LDtkRoomManager     // LDtkæ•°æ®é©±åŠ¨æˆ¿é—´ç®¡ç†
â”œâ”€â”€ Data                    // æ•°æ®ç®¡ç†å’Œå·¥å‚æ¨¡å¼
â”‚   â”œâ”€â”€ CastleDBManager     // å¤–éƒ¨æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ GameData            // æ¸¸æˆæ•°æ®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ WeaponFactory       // æ­¦å™¨åˆ›å»ºå·¥å‚
â”‚   â””â”€â”€ DataDrivenWeapon    // æ•°æ®é©±åŠ¨çš„æ­¦å™¨å®ç°
â”œâ”€â”€ Level                   // å…³å¡åŠ è½½å’Œè§£æ
â”‚   â”œâ”€â”€ LDtkManager         // LDtkæ–‡ä»¶è§£æå™¨
â”‚   â””â”€â”€ LDtkData            // LDtkæ•°æ®ç»“æ„æ˜ å°„
â”œâ”€â”€ Animation               // åŠ¨ç”»æ§åˆ¶ç³»ç»Ÿ
â”‚   â””â”€â”€ AnimationController // ç»Ÿä¸€åŠ¨ç”»æ¥å£
â”œâ”€â”€ Effects                 // è§†è§‰æ•ˆæœå’Œåé¦ˆ
â”‚   â”œâ”€â”€ EffectsManager      // ç‰¹æ•ˆç®¡ç†å™¨
â”‚   â””â”€â”€ ScreenFlash         // å±å¹•é—ªçƒæ•ˆæœ
â””â”€â”€ Tools                   // å¼€å‘è¾…åŠ©å·¥å…·
    â””â”€â”€ GameSetupWizard     // é¡¹ç›®å¿«é€Ÿé…ç½®å·¥å…·
```

## ğŸ”„ æ•°æ®æµå‘å›¾

### ç©å®¶è¾“å…¥ â†’ åŠ¨ä½œæ‰§è¡Œæµç¨‹

```
[ç©å®¶è¾“å…¥] 
    â†“
[PlayerInput.Update()] â†’ æ”¶é›†è¾“å…¥çŠ¶æ€
    â†“
[PlayerStateMachine.Update()] â†’ çŠ¶æ€è½¬æ¢åˆ¤æ–­
    â†“
[å½“å‰State.Update()] â†’ æ‰§è¡Œå…·ä½“çŠ¶æ€é€»è¾‘
    â†“                    â†“
[PlayerController]   [æ­¦å™¨æ”»å‡»]
 ç§»åŠ¨/è·³è·ƒå¤„ç†          â†“
    â†“               [Weapon.TryAttack()]
[ç‰©ç†ç³»ç»Ÿæ›´æ–°]          â†“
    â†“               [CombatManager.DealDamage()]
[AnimationController]   â†“
 æ’­æ”¾å¯¹åº”åŠ¨ç”»        [Health.TakeDamage()]
                       â†“
                   [EffectsManager]
                    æ’­æ”¾è§†è§‰æ•ˆæœ
```

### æ•°æ®é©±åŠ¨ç³»ç»Ÿæµç¨‹

```
[CastleDBæ–‡ä»¶] â†’ [CastleDBManager] â†’ è§£ææ¸¸æˆæ•°æ® â†’ [å†…å­˜æ•°æ®å­—å…¸]
                                                       â†“
[LDtkæ–‡ä»¶] â†’ [LDtkManager] â†’ è§£æå…³å¡æ•°æ® â†’ [å…³å¡å®ä½“ç”Ÿæˆ]
    â†“                                        â†“
[ç“¦ç‰‡åœ°å›¾ç”Ÿæˆ] â† [LDtkRoomManager] â† [WeaponFactory]
    â†“                  â†“               åˆ›å»ºæ•°æ®é©±åŠ¨çš„æ­¦å™¨
[ç©å®¶å®šä½]         [æ•Œäººç”Ÿæˆ]              â†“
    â†“                  â†“           [DataDrivenWeapon]
[æ¸¸æˆå¼€å§‹]         [AIåˆå§‹åŒ–]         åº”ç”¨æ•°æ®å±æ€§
```

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. å•ä¾‹æ¨¡å¼ (Singleton)
**ä½¿ç”¨åœºæ™¯**: ç®¡ç†å™¨ç±»ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€è®¿é—®ç‚¹

```csharp
// åº”ç”¨ç±»: GameManager, CombatManager, EffectsManager
public class GameManager : MonoBehaviour 
{
    public static GameManager Instance { get; private set; }
    
    private void Awake() 
    {
        if (Instance == null) 
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else 
        {
            Destroy(gameObject);
        }
    }
}
```

### 2. çŠ¶æ€æœºæ¨¡å¼ (State Machine)
**ä½¿ç”¨åœºæ™¯**: ç©å®¶è¡Œä¸ºæ§åˆ¶ï¼Œæ•ŒäººAI

```csharp
// ç©å®¶çŠ¶æ€æœºç»“æ„
PlayerStateMachine
â”œâ”€â”€ IdleState      // å¾…æœºçŠ¶æ€
â”œâ”€â”€ MoveState      // ç§»åŠ¨çŠ¶æ€  
â”œâ”€â”€ JumpState      // è·³è·ƒçŠ¶æ€
â”œâ”€â”€ FallState      // ä¸‹è½çŠ¶æ€
â”œâ”€â”€ AttackState    // æ”»å‡»çŠ¶æ€
â””â”€â”€ RollState      // ç¿»æ»šçŠ¶æ€

// çŠ¶æ€è½¬æ¢é€»è¾‘åœ¨æ¯ä¸ªçŠ¶æ€çš„Update()æ–¹æ³•ä¸­å¤„ç†
```

### 3. å·¥å‚æ¨¡å¼ (Factory)
**ä½¿ç”¨åœºæ™¯**: åŠ¨æ€åˆ›å»ºæ¸¸æˆå¯¹è±¡

```csharp
// WeaponFactory - æ ¹æ®æ•°æ®åˆ›å»ºæ­¦å™¨
public GameObject CreateWeapon(string weaponId) 
{
    var weaponData = CastleDBManager.Instance.GetWeapon(weaponId);
    return ConfigureWeapon(InstantiatePrefab(weaponData), weaponData);
}
```

### 4. ç»„åˆæ¨¡å¼ (Component)
**ä½¿ç”¨åœºæ™¯**: Unityçš„Componentç³»ç»Ÿï¼Œæ¨¡å—åŒ–åŠŸèƒ½

```csharp
// ç©å®¶GameObjectç»„åˆç¤ºä¾‹
Player GameObject
â”œâ”€â”€ PlayerController    (æ§åˆ¶é€»è¾‘)
â”œâ”€â”€ Rigidbody2D        (ç‰©ç†æ¨¡æ‹Ÿ)
â”œâ”€â”€ Health             (ç”Ÿå‘½ç³»ç»Ÿ)
â”œâ”€â”€ HitstunController  (ç¡¬ç›´æ§åˆ¶)
â”œâ”€â”€ AnimationController(åŠ¨ç”»ç®¡ç†)
â””â”€â”€ Collider2D         (ç¢°æ’æ£€æµ‹)
```

### 5. è§‚å¯Ÿè€…æ¨¡å¼ (Observer)
**ä½¿ç”¨åœºæ™¯**: äº‹ä»¶é€šçŸ¥ç³»ç»Ÿ

```csharp
// Healthç³»ç»Ÿäº‹ä»¶ç¤ºä¾‹
public class Health : MonoBehaviour 
{
    public event Action<float, float> OnHealthChanged;  // ç”Ÿå‘½å€¼å˜åŒ–
    public event Action<DamageInfo> OnDamageTaken;      // å—ä¼¤äº‹ä»¶
    public event Action OnDeath;                        // æ­»äº¡äº‹ä»¶
}
```

## ğŸ“Š ç³»ç»Ÿäº¤äº’å›¾

### æˆ˜æ–—ç³»ç»Ÿäº¤äº’

```
[ç©å®¶æ”»å‡»] â†’ [Weapon.TryAttack()] â†’ [æ£€æµ‹ç›®æ ‡] â†’ [åˆ›å»ºDamageInfo]
                                        â†“
[CombatManager.DealDamage()] â† [æ­¦å™¨ä¼¤å®³è®¡ç®—] â† [åº”ç”¨æ­¦å™¨æ•°æ®]
            â†“
    [ç›®æ ‡.Health.TakeDamage()]
            â†“
        [è®¡ç®—æœ€ç»ˆä¼¤å®³] â†’ [åº”ç”¨ä¼¤å®³æŠ—æ€§]
            â†“
        [æ›´æ–°ç”Ÿå‘½å€¼] â†’ [è§¦å‘å—ä¼¤äº‹ä»¶]
            â†“                â†“
    [æ£€æŸ¥æ­»äº¡çŠ¶æ€]    [è§†è§‰æ•ˆæœåé¦ˆ]
            â†“                â†“
        [è§¦å‘æ­»äº¡]      [å±å¹•éœ‡åŠ¨/ç²’å­]
```

### æˆ¿é—´ç³»ç»Ÿäº¤äº’

```
[ä¼ ç»Ÿæ¨¡å¼]                    [æ•°æ®é©±åŠ¨æ¨¡å¼]
     â†“                            â†“
[RoomManager]                [LDtkRoomManager]
     â†“                            â†“
[ç¨‹åºåŒ–ç”Ÿæˆæˆ¿é—´]              [åŠ è½½LDtkå…³å¡æ–‡ä»¶]
     â†“                            â†“
[åˆ›å»ºRoomå¯¹è±¡]               [LDtkManagerè§£æ]
     â†“                            â†“
[è®¾ç½®æˆ¿é—´è¿æ¥]               [ç”Ÿæˆç“¦ç‰‡åœ°å›¾+å®ä½“]
     â†“                            â†“
[ç”Ÿæˆæ•Œäººå’Œç‰©å“]              [åº”ç”¨CastleDBæ•°æ®]
     â†“                            â†“
[RoomDoorä¼ é€é€»è¾‘]           [RoomDoorä¼ é€é€»è¾‘]
```

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„ç©å®¶çŠ¶æ€

1. **ç»§æ‰¿PlayerStateåŸºç±»**
```csharp
public class NewPlayerState : PlayerState 
{
    public override void Enter() { /* è¿›å…¥çŠ¶æ€æ—¶çš„åˆå§‹åŒ– */ }
    public override void Update() { /* æ¯å¸§æ›´æ–°é€»è¾‘å’ŒçŠ¶æ€è½¬æ¢ */ }
    public override void Exit() { /* ç¦»å¼€çŠ¶æ€æ—¶çš„æ¸…ç† */ }
}
```

2. **åœ¨çŠ¶æ€æœºä¸­æ³¨å†Œ**
```csharp
// PlayerStateMachineæ„é€ å‡½æ•°ä¸­æ·»åŠ 
NewState = new NewPlayerState(this, player);
```

### æ·»åŠ æ–°çš„æ­¦å™¨ç±»å‹

1. **ç»§æ‰¿WeaponåŸºç±»æˆ–åˆ›å»ºæ•°æ®é©±åŠ¨æ­¦å™¨**
```csharp
public class MagicWeapon : Weapon 
{
    public override bool TryAttack(Vector2 direction) 
    {
        // å®ç°é­”æ³•æ­¦å™¨ç‰¹æœ‰çš„æ”»å‡»é€»è¾‘
        return true;
    }
}
```

2. **åœ¨WeaponFactoryä¸­æ·»åŠ æ”¯æŒ**
```csharp
case "magic":
    return magicWeaponPrefab;
```

### æ·»åŠ æ–°çš„æ•ŒäººAIè¡Œä¸º

1. **æ‰©å±•EnemyStateæšä¸¾**
```csharp
public enum EnemyState 
{
    Idle, Patrol, Chase, Attack, Hurt, Death,
    NewBehavior  // æ–°AIè¡Œä¸º
}
```

2. **åœ¨UpdateState()ä¸­å®ç°é€»è¾‘**

### é›†æˆæ–°çš„å¤–éƒ¨å·¥å…·

å‚è€ƒCastleDBå’ŒLDtkçš„é›†æˆæ–¹å¼ï¼š
1. åˆ›å»ºå¯¹åº”çš„Managerç±»
2. å®šä¹‰æ•°æ®ç»“æ„æ˜ å°„
3. å®ç°æ–‡ä»¶è§£æé€»è¾‘  
4. æä¾›ç»Ÿä¸€çš„è®¿é—®æ¥å£

## âš¡ æ€§èƒ½è€ƒè™‘

### å¯¹è±¡æ± æ¨¡å¼
- **æŠ•å°„ç‰©å¯¹è±¡æ± **: é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯å­å¼¹
- **ç‰¹æ•ˆå¯¹è±¡æ± **: ç²’å­æ•ˆæœå¤ç”¨
- **æ•Œäººå¯¹è±¡æ± **: å¤§é‡æ•Œäººçš„å†…å­˜ç®¡ç†

### äº‹ä»¶ç³»ç»Ÿä¼˜åŒ–  
- åŠæ—¶å–æ¶ˆäº‹ä»¶è®¢é˜…ï¼Œé¿å…å†…å­˜æ³„æ¼
- ä½¿ç”¨å¼±å¼•ç”¨å¤„ç†é•¿ç”Ÿå‘½å‘¨æœŸçš„äº‹ä»¶è®¢é˜…

### æ•°æ®åŠ è½½ç­–ç•¥
- CastleDBæ•°æ®åœ¨æ¸¸æˆå¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½
- LDtkå…³å¡æ•°æ®æŒ‰éœ€åŠ è½½ï¼Œæ”¯æŒå¼‚æ­¥åŠ è½½
- èµ„æºé¢„åŠ è½½å’Œå»¶è¿ŸåŠ è½½çš„å¹³è¡¡

## ğŸš€ æœªæ¥æ‰©å±•æ–¹å‘

1. **ç½‘ç»œå¤šäººæ”¯æŒ** - æ·»åŠ ç½‘ç»œåŒæ­¥å±‚
2. **å­˜æ¡£ç³»ç»Ÿ** - ç©å®¶è¿›åº¦å’Œæ¸¸æˆçŠ¶æ€æŒä¹…åŒ–  
3. **modæ”¯æŒ** - æä¾›æ›´å¼€æ”¾çš„æ•°æ®æ¥å£
4. **æ€§èƒ½åˆ†æå·¥å…·** - å†…ç½®æ€§èƒ½ç›‘æ§é¢æ¿
5. **å¯è§†åŒ–ç¼–è¾‘å™¨** - Unity Editoræ‰©å±•å·¥å…·

---

è¿™ä¸ªæ¶æ„æ–‡æ¡£æè¿°äº†æ¡†æ¶çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³å’Œæ‰©å±•æ–¹æ³•ã€‚å¦‚æœä½ éœ€è¦äº†è§£ç‰¹å®šç³»ç»Ÿçš„è¯¦ç»†å®ç°ï¼Œè¯·å‚è€ƒå¯¹åº”çš„æºä»£ç æ–‡ä»¶ã€‚